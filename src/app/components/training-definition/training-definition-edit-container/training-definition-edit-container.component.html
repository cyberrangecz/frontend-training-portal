<mat-expansion-panel  [expanded]="!(editMode$ | async)" [disabled]="!(editMode$ | async)">
  <mat-expansion-panel-header>
    <mat-panel-title>
      <span *ngIf="(editMode$ | async) else newTrainingTitle">Edit Training Definition</span>
      <ng-template #newTrainingTitle>Create Training Definition</ng-template>
    </mat-panel-title>
    <mat-panel-description>{{ tdTitle$ | async }}</mat-panel-description>
  </mat-expansion-panel-header>
  <kypo2-training-definition-edit-controls
    [disabled]="saveDisabled$ | async"
    [editMode]="editMode$ | async"
    (saveAndEditLevels)="onSaveAndEditLevels()"
    (save)="onSave()">
  </kypo2-training-definition-edit-controls>
  <mat-divider></mat-divider>
  <kypo2-training-definition-edit
    (edited)="onTrainingDefinitionChanged($event)"
    [trainingDefinition]="trainingDefinition$ | async">
  </kypo2-training-definition-edit>
</mat-expansion-panel>

<mat-expansion-panel [disabled]="!(editMode$ | async)" [expanded]="editMode$ | async">
  <mat-expansion-panel-header>
    <mat-panel-title>Edit Levels</mat-panel-title>

    <mat-panel-description>
      <span *ngIf="levelsCount >= 0 else levelCountFromTD">Training definition contains {{ levelsCount }} level(s)</span>
      <ng-template #levelCountFromTD>
        <span>Training definition contains {{ (trainingDefinition$ | async).levels.length}} level(s)</span>
      </ng-template>
      <div class="panel-description-error" *ngIf="unsavedLevels.length > 0">
        <mat-icon color="warn">warning</mat-icon>
        <mat-error>Some levels are not saved</mat-error>
      </div>
    </mat-panel-description>
  </mat-expansion-panel-header>
  <kypo2-level-overview (levelsCount)="onLevelsCountChanged($event)" (unsavedLevels)="onUnsavedLevelsChanged($event)" [trainingDefinition]="trainingDefinition$ | async"></kypo2-level-overview>
</mat-expansion-panel>
