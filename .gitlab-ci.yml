image: angulardeploy

variables:
    LANG: C.UTF-8
    LC_ALL: C.UTF-8

stages:
    - testAngular
    - buildAngular

before_script:
    # Get version.
    #     Variable CI_COMMIT_TAG is set only when tag was pushed.
    - export VERSION=$(if [[ "$CI_COMMIT_TAG" == "" ]]; then echo $(dpkg-parsechangelog --show-field version); else echo $CI_COMMIT_TAG | cut -c 2-; fi)
    - cp $NPMRC_PULL ~/.npmrc
    - npm install

testAngular:
    stage: testAngular
    script:
        - ng test --browsers ChromeHeadlessNoSandbox --watch=false
    only:
        - triggers
        - branches
        - tags

buildAngular:
    stage: buildAngular
    script:
        - ng build --configuration=production
    only:
        - triggers
        - branches
        - tags
    artifacts:
      paths:
        - ./dist
      expire_in: 1 hour
